<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="logo.jpg" type="logo">
  <title>N A Agro</title>

  <style>
    * {
      box-sizing: border-box;
      user-select: none;
    }

    table tr td {
      border: 1px solid rgba(121, 121, 121, 0.678) !important;
      margin-top: 5px;

    }

    .cnhangepasspage {
      height: 100%;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    body {
      font-family: sans-serif;
      margin: 0;
      background: #f4f4f4;

    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.301);
      height: 100vh;
      width: 100%;
      position: absolute;
      top: 0;
      right: 0;
    }

    .loading2 {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(255, 255, 255, 0.301);
      position: static;
      top: 0;
      right: 0;
    }

    .loading2 img {
      height: 15px !important;
      width: 15px !important;

    }

    .productpagetable {
      display: flex;
      justify-content: center;
      align-items: center;

    }

    .productpagetable td:nth-child(2) {
      width: 150px;
      display: flex;
      gap: 5px;
      justify-content: space-around;
      align-items: center;
    }

    /* LOGIN STYLES */
    .login-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 99vw;
      background: #f4f4f4;
    }

    .login-box {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      /* width: 80%; */
      max-width: 300px;
    }

    .login-box input[type="password"] {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
    }

    /* HOME STYLES */
    #home-section {
      display: none;
    }

    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #007bff;
      color: white;
      padding: 5px;
      height: 150px;
    }

    .navbar .logo {
      font-weight: bold;
      font-size: 18px;
    }

    .navbar .logo img {
      height: 250px;
      width: 250px;
    }

    .navbar .settings {
      font-size: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 15px;
    }

    .button {
      background: white;
      text-align: center;
      border-radius: 8px;
      font-size: 14px;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .button:active {
      background-color: #a2c1e2;
    }

    .large-button {
      font-size: 18px;
      padding: 30px;
    }

    .counter {
      position: absolute;
      top: 5px;
      right: 10px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 4px 8px;
      font-size: 12px;
    }

    .statement-btn {
      display: block;
      width: 90%;
      margin: 20px auto;
      padding: 15px;
      background: #28a745;
      color: white;
      text-align: center;
      border-radius: 8px;
      font-size: 18px;
      border: none;
    }

    .statement-btn:active {
      background-color: #5c5c5c !important;
    }

    .statusBox {
      /* background-color: rgb(211, 205, 205); */
      border: 2px solid rgb(128, 128, 128);
      border-radius: 25px;
      margin: 15px;
      padding: 15px;
    }

    .statusBtn {
      border: 1px solid rgb(110, 110, 110);
      border-radius: 50px;
      height: 35px;
      width: 120px;
      gap: 5px;
    }

    .popup {
      height: 98vh;
      width: 95%;
      background-color: rgb(255, 255, 255);
      z-index: 2;
      position: absolute;
      top: 15%;
      margin: 10px;
      border: 1px solid black;
      border-radius: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 800;
      color: rgb(14, 14, 14);
    }

    .popup span {
      display: flex;
      flex-direction: column;
      gap: 5px;
      align-items: center;
    }

    input,
    textarea {
      border-radius: 15px;
      height: 30px;
      width: 150px;
      background-color: #bebebe;
      font-weight: 900;
      color: rgb(0, 0, 0);
      font-size: 16px;
      outline: none;
      border: none;
      padding-left: 20px !important;
      user-select: none;
    }

    .costhistory {
      /* height: 60vh; */
      width: 100%;
      display: flex;
      padding: 5px;
      font-weight: 600;
      font-size: 15px;
      overflow: auto;
      flex-direction: column;
    }

    .radio {
      background-color: rgb(255, 255, 255);
      border: 1px solid rgb(0, 0, 0);
      border-radius: 50%;
      height: 15px;
      width: 15px;
    }

    .radioP {
      display: flex;
      gap: 50px;
      height: 50px;
      width: 350px;
      justify-content: flex-start;
      align-items: center;
      /* background-color: red; */
    }

    .radio::before {}

    .link {
      font-size: 20px;
      color: rgb(0, 0, 0);
      font-weight: 800;
      background-color: transparent;
      border: none;
      text-decoration: underline;
    }

    .link:active {
      background-color: rgba(5, 17, 124, 0.719);
    }
  </style>
</head>

<body>
  <!-- LOGIN SECTION -->
  <div class="login-container" id="create-section" style="display: none;">
    <div style="width: 99vw; display: flex; justify-content: center; align-items: center;">
      <img src="logo.png" alt="logo" style="width: auto; height: 300px;">
    </div>
    <div style="text-align: center; width: 100vw; font-size: 20px; font-weight: 800;">Create Your Goddamn Account</div>
    <div class=""
      style="width: 99vw; display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 20px; margin: 10px; padding: 10px;">
      <input type="text" placeholder="Your Name" id="name" />
      <input type="password" placeholder="Password" id="pass" />
      <button id="createuser" class="statusBtn">Create Account</button>
      <button type="submit" id="login2"
        style="text-decoration: underline; background-color: transparent; color: #007bffd3; border: none; font-size: 8px;">log
        in instead?</button>
    </div>
  </div>

  <div class="login-container" id="login-section" style="display: block;">
    <div style="width: 99vw; display: flex; justify-content: center; align-items: center;">
      <img src="logo.png" alt="logo" style="width: 320px; height: 300px;">
    </div>
    <div class="" style="display: flex; justify-content: center; align-items: center; width: 99vw;">
      <div
        style="width: 99vw; height: 20vh; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px; padding: 10px; margin: 10px;">
        <p type="text" placeholder="Enter Username" id="user" style="font-weight: 800; font-size: 20px;">Hi Abir </p>
        <input type="password" placeholder="Password" id="password" required />
        <button id="login" class="statusBtn">Login</button>
        <button id="createacc"
          style="text-decoration: underline; background-color: transparent; color: #007bffd3; border: none; font-size: 8px;">want
          to create account instead?</button>
      </div>
    </div>
  </div>



  <!-- HOME SECTION -->
  <div id="home-section" style="display: none;">
    <div class="navbar">
      <div id="logocont" class="logo"><img id="logoimg" src="logo.png" alt="N A Agro" /></div>
    </div>

    <div id="homepage">
      <div class="statusBox">
        <div style="display:  flex; flex-direction: column; gap: 5px;">
          <div style="display:  flex; gap: 5px;">
            <div class="statusBtn button" id="totalbank"><span id="totalbankspan">
                Total Bank
              </span></div>
            <div class="statusBtn button" id="totalcash"><span id="totalcashspan">Total Cash</span></div>
            <div class="statusBtn button" id="totalWithdraw"><span>Total Withdraw</span></div>
          </div>
          <div style="display: flex; gap: 5px;">
            <div class="statusBtn button" id="totalSell"><span>Total Sell</span></div>
            <div class="statusBtn button" id="totalcost"><span>Total cost</span></div>
            <div class="statusBtn button" id="totalDue"><span>Total Due</span></div>
          </div>
        </div>
      </div>

      <div></div>

      <div class="grid">
        <div class="button large-button" id="addcostbtn">
          <!-- <div class="counter">3</div> -->
          üßæ Add Cost
        </div>
        <div class="button large-button" id="addsellbtn">
          <!-- <div class="counter">7</div> -->
          üõí Add Sell
        </div>
        <div id="totalproductbtn" class="button large-button">
          <!-- <div class="counter">5</div> -->
          üìà Product list
        </div>
        <div id="addduebtn" class="button large-button">
          <!-- <div class="counter">2</div> -->
          üí∏ Add Due
        </div>
        <div id="settingbtn" class="button large-button">
          <!-- <div class="counter">2</div> -->
          ‚öôÔ∏è settings
        </div>
        <div id="notebtn" class="button large-button">
          <!-- <div class="counter">2</div> -->
          <img src="edit.svg" alt="Note edit">
          Notes
        </div>
      </div>

      <button id="logoutbtn" class="statement-btn">
        üìä Logout</button>
    </div>
  </div>


  <!-- POPUP SECTION -->

  <!-- otp poup -->
  <div class="popup" style="display:  none; justify-content: center; align-items: flex-start; " id="otppopup">
    <div class="bankAdd"
      style="gap: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <span style="color: green;">verify the account, enter the otp sent to your mail account!!</span>

      <input id="otp" type="number" placeholder="Type OTP">
      <button id="cancelVerify" class="button"
        style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
        Cancel</button>
      <div><button id="verifybtn">Verify</button></div>
    </div>
    </span>
  </div>

  <!-- add in bank poup -->
  <div class="popup" style="display:  none;" id="addinbankpage">
    <div class="bankAdd">
      <span>Add Blanace in Bank</span>
      <div style="display: flex; flex-direction:  column; gap: 10px; justify-content: center; align-items: center;">
        <span>
          Date:
          <input id="bankdate" type="date" data-de>
        </span>
        <span style="display:  flex;"> Amount:
          <input type="number" name="bankAmount" id="bankamount" placeholder="0.00">
        </span>
        <span style="display:  flex;"> Note:
          <input type="text" name="banknote" id="banknote" placeholder="Empty">
        </span>
        </span>
        <div style="display: flex; gap:50px; padding-top:10px ;">
          <button id="addbankdata" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Add</button>
          <button id="canceladdbankpopup" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Back</button>
        </div>
        <div style="color: green; display: none;" class="idclassforsuccess">Successfully Added</div>
        </span>
        <div><button id="histbank" style="height: 15px;width: 30px; font-size: 9px;">hist</button></div>
      </div>
    </div>
  </div>

  <!-- add in cash popup -->
  <div class="popup" style="display: none;" id="addincashpage">
    <div class="bankAdd">
      <span>Add Blanace in Cash</span>
      <div style="display: flex; flex-direction:  column; gap: 10px; justify-content: center; align-items: center;">
        <span>
          Date:
          <input id="addcashdate" type="date">
        </span>
        <span id="" style="display:  flex;"> Amount:
          <input type="number" name="bankAmount" id="addcashamount" placeholder="0.00">
        </span>
        <span style="display:  flex;"> Note:
          <input type="text" name="bankAmount" id="addcashnote" placeholder="Empty">
        </span>
        </span>
        <div style="display: flex; gap:50px; padding-top:10px ;">
          <button id="addcashdata" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Add</button>
          <button id="addincashcancelpopup" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Back</button>
        </div>
        <div style="color: green; display: none;" id="cashaddsuccess">Successfully Added</div>
        </span>
        <div><button id="histcash" style="height: 15px;width: 30px; font-size: 9px;">hist</button></div>
      </div>
    </div>
  </div>

  <!-- add withdraw popup -->
  <div class="popup" style="display: none;" id="withpopuppage">
    <div class="bankAdd">
      <u><span>Add Withdraw</span></u>
      <div style="display: flex; flex-direction:  column; gap: 10px; justify-content: center; align-items: center;">
        <span>
          Date:
          <input type="date" id="withdrawdate">
        </span>
        <span style="display:  flex;"> Amount:
          <input id="withdrawamount" type="number" name="bankAmount" placeholder="0.00">
        </span>
        <span style="display:  flex;"> Note:
          <input id="withdrawnote" type="text" name="bankAmount" placeholder="Empty">
        </span>
        </span>
        <span>
          <select name="SelectWithdraw" id="SelectWithdraw">Select Withdraw:
            <option value="cash">Cash</option>
            <option value="bank">Bank</option>
          </select>
        </span>
        <div style="display: flex; gap:50px; padding-top:10px ;">
          <button class="button" id="addWithdraw"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Withdraw</button>
          <button id="withdrawpopupcancel" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Back</button>
        </div>
        <div style="color: green; display: none;" id="withdrawaddsuccess">Withdraw success!!</div>
        </span>
        <div><button id="histwithdraw" style="height: 15px;width: 30px; font-size: 9px;">hist</button></div>
      </div>
    </div>
  </div>

  <!-- add new product popup -->
  <div id="addproductpopup" class="popup" style="display: none;">
    <div class="bankAdd">
      <u><span>Add product</span></u>
      <div style="display: flex; flex-direction:  column; gap: 10px; justify-content: center; align-items: center;">
        <span>
          Product Name:
          <input id="productname" type="text" placeholder="Name">
        </span>
        <span style="display:  flex;"> Quantity:
          <input type="number" name="bankAmount" id="procutquantity" placeholder="0.00">
        </span>
        </span>
        <span>
        </span>
        <div style="display: flex; gap:50px; padding-top:10px ;">
          <button class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"
            id="productaddlistbtn"> Add</button>
          <button id="newproductcencel" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Back</button>
        </div>
        <span style="color: #28a745; display: none;" id="prodaddsuccessmsg">Addes successfully!!</span>
        </span>

      </div>
    </div>
  </div>

  <!-- history popup -->
  <div id="alltimehistory" class="popup" style="display: none; padding: 10px;">
    <div class="bankAdd">
      <u><span>all time history</span></u>
      <div id="totalbankamount"></div>
      <div style="display: flex; flex-direction:  column; gap: 10px; justify-content: center; align-items: center;">
        <hr>
        <div class="addPages" style="font-weight: 800; font-size: 20px">
          <div id="costHistory" class="costhistory" style="width: 95vw;">
            <div style="overflow-y: scroll; height: 45vh; margin: 10px;">
              <table id="histtable" style="width: 100%;">
                <thead>
                  <tr style="">
                    <td>Date</td>
                    <td>Note</td>
                    <td>Amount</td>
                  </tr>
                </thead>
                <tbody style="width: 100vw;">
                </tbody>
              </table>
            </div>
          </div>

        </div>
        </span>
        <div style="display: flex; gap:50px; padding-top:10px ;">
          <button id="historycencel" class="button"
            style="height: 55px; width: 75px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">
            Back</button>
        </div>
        </span>

      </div>
    </div>
  </div>


  <!-- ADD PAGES SECTION -->
  <!-- add sell page -->
  <div id="addsellpage" style="display: none; flex-direction: column; justify-content: center; align-items: center;">
    <div
      style=" margin: 10px 0 20px 0; background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
      <div style="display: flex; justify-content: space-evenly;">
        <span style="font-weight: 900; font-size: 20px;">Add A Sell Record</span>
      </div>
    </div>

    <div style="display: flex; gap: 15px; margin: 15px;">
      <span>Transaction type:</span>
      <select name="cashBank" id="sellmethod">
        <option value="cash">Cash</option>
        <option value="bank">Bank</option>
        <!-- <option value="due">Due</option> -->
      </select>
      <span>select product</span>
      <select name="cashBank" id="productselect">
      </select>
      <div id="qIndicator" style="font-size: 9px; color: green;">
        available: <span id="currentstock"></span> product
      </div>
    </div>
    <div>
      <div> Date:
        <input id="selldate" type="date" style="background-color: white; padding: 3px;">
      </div>
    </div>
    <div style="margin: 10px; display: flex; align-items: center; gap: 15px;"> <span>Buyer Name</span>
      <textarea style="padding: 5px; border-radius: 15px;" name="costAddNote" id="buyername" placeholder="Buyer Name"
        cols="15" rows="1"></textarea>
    </div>
    <div style="margin: 10px; display: flex; align-items: center; gap: 15px;"> <span>Sell Details</span>
      <textarea style="padding: 5px; border-radius: 15px;" name="costAddNote" id="sellnote"
        placeholder="How Did You Sold and what you sold" cols="16" rows="3"></textarea>
    </div>
    <div style="margin: 5px;"> Total Quantity
      <input id="quantitysell" type="number" placeholder="0.00" style="background-color: white; padding: 5px;">
    </div>
    <div style="margin: 5px;"> Each Price
      <input id="eachprice" type="number" placeholder="0.00" style="background-color: white; padding: 5px;">
    </div>
    <div> Total Amount
      <input id="totalamountrechived" type="number" placeholder="0.00" style="background-color: white; padding: 5px;">
    </div>
    <div style="display: flex; justify-content: center; align-items: center; font-size: 14px; margin: 5px;">
      <span>Discounted?</span>
      <input type="checkbox" name="choice" id="discountedCheck" value="yes" style="height: 20px; width: 20px;">
    </div>
    <div style="display: flex;">
      <div id="addselldata" style="margin: 10px;" class="statement-btn"> Add
      </div>
      <div id="addsellpagecancel" style="margin: 10px; background-color: red;" class="statement-btn"> Back
      </div>
    </div>
    <span style="color: #28a745; display: none;" id="selladdedsuccessfully">Product Sell Added!!</span>
    <hr>
    <div class="addPages" style="font-weight: 800; font-size: 20px; width: 100vw;">
      <div
        style=" background-color: rgb(189, 189, 189); width: 100vw; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
        <div style="display: flex; justify-content: space-evenly;">
          <span>Total Sell</span>
          <span id="totalsellhappened">0.00</span>
        </div>
      </div>
      <div id="costHistory" class="costhistory">
        <div style="width: 98vw;height: 80vw; overflow-y: scroll; display: flex; justify-content: center;">
          <table style="width: 90vw; ">
            <thead>
              <tr style="">
                <td>Date</td>
                <td>Detials</td>
                <td>Buyer</td>
                <td>Product</td>
                <td>Amount</td>
              </tr>
            </thead>
            <tbody id="tablesell">

            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- Total product page -->
  <div id="totalproductpage" style="display: none;">
    <div class="addPages"
      style="width: 100vw; font-weight: 800; font-size: 20px; display: flex; justify-content: center; flex-direction: column;">
      <div
        style=" background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
        <div style="display: flex; justify-content: space-evenly;">
          <span>Products List</span>
        </div>
      </div>
      <hr>
      <div style="display: flex; align-items: center; width: 100%; justify-content: space-around;">
        <div><button id="addnewproduct" class="statement-btn" style="width: 30vw;">Add New Product</button></div>
        <div><button id="totalproductbackbtn" style="width: 30vw;" class="statement-btn">Back</button></div>
      </div>
      <hr>
      <div id="costHistory" class="costhistory" style="height: 50vh; width: 99vw;">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; width: 90vw;">
          <div style="display:  flex; justify-content: space-evenly; width: 90vw;">
            <span style="width: 90vw; ">Product Name</span>
            <span>Quantity</span>
          </div>
          <table style="width: 90vw; height: 60vh;">
            <tbody id="productlisttable" style="width: 90vw;">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- add Due Page -->
  <div id="addduepage" style="display: none; flex-direction: column; justify-content: center; align-items: center;">
    <div
      style=" margin: 10px 0 20px 0; background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
      <div style="display: flex; justify-content: space-evenly;">
        <span style="font-weight: 900; font-size: 20px;">Add Due</span>
      </div>
    </div>

    <div>
      <div> Date:
        <input id="addduedate" type="date" style="background-color: white; padding: 3px;">
      </div>
    </div>
    <div style="margin: 10px; display: flex; align-items: center; gap: 15px;"> <span>Details</span>
      <textarea style="padding: 5px; border-radius: 15px;" name="costAddNote" id="addduenote"
        placeholder="Add Detils/Name" cols="15" rows="3"></textarea>
    </div>
    <div> Ttoal Amount
      <input id="adddueamount" type="number" placeholder="0.00" style="background-color: white; padding: 5px;">
    </div>
    <div style="display: flex;">
      <div id="addduedata" style="margin: 10px;" class="statement-btn"> Add
      </div>
      <div style="margin: 10px;" class="statement-btn" id="addduepagecancel"> Back
      </div>
    </div>
    <span id="msgsuccessfordue" style="display: none; color: green;">Addess Successfully!!</span>
    <hr>
    <div class="addPages" style="font-weight: 800; width: 99vw; font-size: 20px">
      <div
        style=" background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
        <div style="display: flex; justify-content: space-evenly;">
          <span>Total Due</span>
          <span style="color: red;" id="totalsuespan">500 </span>
        </div>
      </div>
      <div id="costHistory" class="costhistory"
        style="width: 99vw; display: flex; justify-content: center; align-items: center;">
        <div
          style="width: 96vw; display: flex; justify-content: center; align-items: center;height:45vh; position: relative;">
          <table style="width: 90vw; margin-top: 15px; position: absolute;top: 2%;">
            <thead>
              <tr style="">
                <td>Date</td>
                <td>Detials</td>
                <td>Amount</td>
              </tr>
            </thead>
            <tbody id="addduetable" style=""></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
  <!-- add Note page -->
  <div id="notepage" style="display: none; flex-direction: column; justify-content: center; align-items: center;">
    <div
      style=" margin: 10px 0 20px 0; background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
      <div style="display: flex; justify-content: space-evenly;">
        <span style="font-weight: 900; font-size: 20px;">Create Note</span>
      </div>
    </div>

    <div>
      <div> Date:
        <input id="notepadDate" type="date" style="background-color: white; padding: 3px;">
      </div>
      <div style="margin-top: 10px;"> Title:
        <input id="notepadtitle" type="text" style="background-color: white; padding: 3px;" placeholder="add a title">
      </div>
    </div>
    <div style="margin: 10px; display: flex; align-items: center; gap: 15px;"> <span>Details</span>
      <textarea style="padding: 5px; border-radius: 15px;" name="costAddNote" id="notepadnote"
        placeholder="Add Detils note" cols="15" rows="3"></textarea>
    </div>

    <div style="display: flex;">
      <div id="notedataaddbtn" style="margin: 10px;" class="statement-btn"> Add
      </div>
      <div id="notepagecancelbtn" style="margin: 10px;" class="statement-btn"> Back
      </div>
    </div>
    <hr>
    <div class="addPages" style="font-weight: 800; font-size: 20px">
      <div
        style=" background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
        <div style="display: flex; justify-content: space-evenly;">
          <span>Note List</span>
        </div>
      </div>
      <div id="NoteHistory" class="costhistory" style="display: flex; width: 98vw; height: 40vh;">
        <div>
          <!-- Todo/// add note title system -->
          <table style="width: 100%;">
            <thead>
              <tr style="">
                <td>Date</td>
                <td>title</td>
                <td>Details</td>
              </tr>
            </thead>
            <tbody id="notepadtablebody"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- add setting page -->
  <!-- Todo// pass change, reset database, logo/icon change -->
  <div id="settingpage" style="display: none; flex-direction: column; justify-content: center; align-items: center;">
    <div
      style=" margin: 10px 0 20px 0; background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
      <div style="display: flex; justify-content: space-evenly;">
        <span style="font-weight: 900; font-size: 20px;">Setiings</span>
      </div>
    </div>
    <div style="display: flex;">
      <div style="margin: 10px;" class="">
        <div style="display: flex; flex-direction: column; gap: 20px; align-items: flex-start;">
          <div class="radioP">
            <span class="radio"></span>
            <div class="link">Statement</div>
          </div>
          <div class="radioP">
            <span class="radio"></span>
            <div class="link" id="changepasswordbtn">Change password</div>
          </div>

          <div class="radioP">
            <span class="radio"></span>
            <div style="display: flex;  justify-content: center; align-items: center; width: 150px; gap: 3px;">
              <select class="link" style="width: 110px;" name="resetCollection" id="resetcollectionselect">
                <option value="sell">sell</option>
                <option value="cost">cost</option>
                <option value="withdraw">withdraw</option>
                <option value="due">due</option>
                <option value="user">all user data</option>
                <option value="products">products</option>
                <option value="bank">bank</option>
                <option value="cash">cash</option>
                <option value="all" id="factoryresetbtn">Reset All</option>
              </select>
              <div id="resetCollectionbtn" style="height: 20ox; width: 40px; font-size: xx-small;" class="link">reset
              </div>

            </div>
          </div>
          <div class="statement-btn" id="settingpagecancelbtn" style="margin: 10px;" class="statement-btn"> Back</div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- add cost page -->
  <div id="addcostpage" style="display: none; flex-direction: column; justify-content: center; align-items: center;">
    <div
      style=" margin: 10px 0 20px 0; background-color: rgb(189, 189, 189); width: 100%; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
      <div style="display: flex; justify-content: space-evenly;">
        <span style="font-weight: 900; font-size: 20px;">Add Cost</span>
      </div>
    </div>
    <div>
      <div> Date:
        <input id="addcostdate" type="date" style="background-color: white; padding: 3px;">
      </div>

      <div style="margin: 5px;">
        <span>
          method:
        </span>
        <select name="method" id="addcostmethod">
          <option value="cash">cash</option>
          <option value="bank">bank</option>
        </select>
      </div>
    </div>
    <div style="margin: 10px; display: flex; align-items: center; gap: 15px;"> <span>Details</span>
      <textarea style="padding: 5px; border-radius: 15px;" name="costAddNote" id="costaddnote" placeholder="Add Detils"
        cols="15" rows="3"></textarea>
    </div>
    <div> Ttoal Amount
      <input id="costaddamount" type="number" placeholder="0.00" style="background-color: white; padding: 5px;">
    </div>
    <div style="display: flex;">
      <div id="addcostdata" style="margin: 10px;" class="statement-btn"> Add
      </div>
      <div style="margin: 10px;" class="statement-btn" id="addcostpagecancel"> Back
      </div>
    </div>
    <div id="costaddsuccess" style="color: green; display: none;">Addess successfully</div>
    <hr>
    <div class="addPages" style="width: 95vw; font-weight: 800; font-size: 20px">
      <div
        style=" background-color: rgb(189, 189, 189); width: 100vw; border: 1px solid black; padding: 10px; height: fit-content; border-radius: 15px;">
        <div style="display: flex; justify-content: space-evenly;">
          <span>Total Cost</span>
          <span id="totalcost2">0.00</span>
          <img id="refreshbtn" src="images/refresh.svg" alt="" style="width: 25px; height: 20px;">
        </div>
      </div>
      <div id="costHistory" class="costhistory" style="height: 35vh; width: 95vw;">
        <div style="width: 95vw;">
          <table style="width: 95vw;">
            <thead>
              <tr style="">
                <td>Date</td>
                <td>Detials</td>
                <td>Amount</td>
              </tr>
            </thead>
            <tbody id="costtablebody" style="width: 95vw;"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>


  <!-- SCRIPT -->
  <script>

    // windows dom loaded funciton
    window.addEventListener("DOMContentLoaded", () => {

      const loginTime = localStorage.getItem('loginTime');
      const SIX_HOURS = 6 * 60 * 60 * 1000;

      if (loginTime && (Date.now() - parseInt(loginTime)) < SIX_HOURS) {
        // Still within session time
        console.log("Auto-login");
        document.getElementById("login-section").style.display = "none";
        document.getElementById("home-section").style.display = "block";
      } else {
        // Session expired
        localStorage.removeItem('loginTime');
        localStorage.removeItem('loggedInUser');
        document.getElementById("login-section").style.display = "block";
        document.getElementById("home-section").style.display = "none";
      }
    });

    document.getElementById("login").addEventListener("click", (e) => {
      e.preventDefault(); // Just in case a form tries to submit
      fetcher('https://agroserver-mdz5.onrender.com/data/user/')
        .then((data) => {
          // console.log(data)
          const user = document.getElementById('user').value;
          const pwd = document.getElementById('password').value;

          const matched = data.find(d => d.amount === pwd);

          if (matched) {
            localStorage.setItem('loginTime', Date.now().toString());
            console.log("login successful");
            document.getElementById("login-section").style.display = "none";
            document.getElementById("home-section").style.display = "block";
          } else {
            alert("Wrong username or password, try again");
          }
        })
        .catch(err => {
          console.error("Error fetching users:", err);
        });
    });

    function mail(sub, whom, msg) {
      fetch('https://agroserver-mdz5.onrender.com/mail', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          to: whom,
          subject: sub,
          message: msg
        })
      })
        .then(res => res.json())
        .then(data => {
          // console.log();
          // alert("Email sent successfully!");
        })
        .catch(err => {
          console.error("Fetch error:", err);
          alert("Failed to send email. Is the server running?");
        });
    }

    function poster(route, data) {
      return fetch(route, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json(); // or .text() if your server returns plain text
        })
        .then(result => {
          // console.log("Response received:", result);
          return result;
        })
        .catch(error => {
          console.error("Error in POST request:", error);
          throw error;
        });
    }

    function fetcher(route) {
      return fetch(route, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json(); // Assumes server returns JSON
        })
        .then(result => {
          return result;
        })
        .catch(error => {
          console.error("Error in GET request:", error);
          throw error;
        });
    }

    function editor(route, data) {
      return fetch(route, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': "*"
        },
        body: JSON.stringify(data)
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .catch(error => {
          console.error("Error in PUT request:", error);
          throw error;
        });
    }

    function decreaser(pName, Q) {
      // console.log(pName,Q)
      let id = ''
      let Qty = 0
      fetcher(`https://agroserver-mdz5.onrender.com/data/products/`)
        .then((datas) => {
          // console.log(datas)
          datas.forEach(data => {
            if (data.note.toLowerCase() == pName.toLowerCase()) {
              id = data._id
              Qty = Number(data.amount) - Number(Q)
            }
          });
          // console.log(id,Q)
          poster(`https://agroserver-mdz5.onrender.com/edit/products/`, { "id": id, "amount": Q ? Number(Qty) : 0 })
          // .then(()=>console.log(""))


        })

    }

    loader = document.createElement("div")
    loader.setAttribute("id", "loading")
    loader.setAttribute("class", "loading")
    loader.innerHTML = `
            <div>
              <img style="height: 50px; width: 50px;" src="images/loading.gif" alt="loading...">
            </div>
        `

    document.querySelector("#logoutbtn").addEventListener("click", () => {
      document.querySelector("#login-section").style.display = "block"
      document.querySelector("#home-section").style.display = "none"
      document.getElementById('password').value = "";
      localStorage.removeItem('loginTime');
      localStorage.removeItem('loggedInUser');
    })

    document.querySelector("#cancelVerify").addEventListener("click", () => {
      location.reload()
    })

    document.querySelector("#login2").addEventListener("click", (() => {
      document.querySelector("#create-section").style.display = "none"
      document.querySelector("#login-container").style.display = "block"
      document.getElementById("home-section").style.display = "none"

    }))

    document.querySelector("#createacc").addEventListener("click", () => {
      document.querySelector("#create-section").style.display = "block"
      // document.querySelector("#login-container").style.display = "none"
      // document.getElementById("home-section").style.display = "none"

      document.querySelector("#createuser").addEventListener("click", () => {
        let name = document.querySelector("#name").value
        let pass = document.querySelector("#pass").value




        let data = {
          "user": name,
          "amount": pass
        }
        // console.log(data)
        presentOTP = Math.floor(1000 + Math.random() * 9000)
        setTimeout(() => {
          presentOTP = Math.floor(1000 + Math.random() * 9000)
        }, 180000)
        mail("GET THE OTP CODE", "freedomabir67@gmail.com", `Enter this OTP code: ${presentOTP} on your website in 3 miniute`)
        mail("GET THE OTP CODE", "nurulabsarimon@gmail.com", `Enter this OTP code: ${presentOTP} on your website in 3 miniute`)
        document.querySelector("#otppopup").style.display = "flex"
        document.querySelector("#verifybtn").addEventListener("click", () => {
          // freedomabir67@gmail.com
          const otp = document.querySelector("#otp").value

          console.log(otp, presentOTP)
          if (Number(otp) === Number(presentOTP)) {
            poster('https://agroserver-mdz5.onrender.com/insert/user/', data)
              .then(() => {
                document.querySelector("#login-section").style.display = "block"
                document.querySelector("#create-section").style.display = "none"
                document.getElementById("home-section").style.display = "none";
                location.reload()
              })
          }
          else if (otp == "no") { return }
          else if (!otp) {
            alert("type otp!")
          }
        })



      })
    })

    document.querySelector("#totalbank").addEventListener("click", () => {
      let b = document.querySelector("#totalbankspan")
      loader2 = document.createElement("div")
      loader2.setAttribute("id", "loading2")
      loader2.setAttribute("class", "loading2")
      loader2.innerHTML = `

              <img style="" src="images/loading.gif" alt="loading...">

        `
      b.appendChild(loader2)

      fetcher("https://agroserver-mdz5.onrender.com/data/bank/")
        .then(data => {
          loader2.style.display = "none"
          totalAmount = 0
          data.forEach((item, index) => {
            if (item.status == true) {
              totalAmount += parseInt(item.amount)
            }
          });

          document.querySelector("#totalbankspan").textContent = `${totalAmount}`
          setTimeout(() => {
            document.querySelector("#totalbankspan").textContent = "Total Bank"
          }, 2000);
        })
    })

    document.querySelector("#totalbank").addEventListener("dblclick", () => {
      document.querySelector("#addinbankpage").style.display = "block"
    })
    document.querySelector("#canceladdbankpopup").addEventListener("click", () => {
      document.querySelector("#addinbankpage").style.display = "none"
    })

    document.querySelector("#totalcash").addEventListener("click", () => {
      let b = document.querySelector("#totalcashspan")
      loader2 = document.createElement("div")
      loader2.setAttribute("id", "loading2")
      loader2.setAttribute("class", "loading2")
      loader2.innerHTML = `

              <img style="" src="images/loading.gif" alt="loading...">

        `
      b.appendChild(loader2)

      fetcher("https://agroserver-mdz5.onrender.com/data/cash/")
        .then(data => {
          loader2.style.display = "none"
          totalAmount = 0
          data.forEach((item, index) => {
            if (item.status == true) { totalAmount += parseInt(item.amount) }
          });

          document.querySelector("#totalcashspan").textContent = `${totalAmount}`
          setTimeout(() => {
            document.querySelector("#totalcashspan").textContent = "Total Cash"
          }, 2000);
        })
    })
    document.querySelector("#totalcash").addEventListener("dblclick", () => {
      document.querySelector("#addincashpage").style.display = "block"
    })
    document.querySelector("#addincashcancelpopup").addEventListener("click", () => {
      document.querySelector("#addincashpage").style.display = "none"
    })

    document.querySelector("#totalWithdraw").addEventListener("click", () => {
      let b = document.querySelector("#totalWithdraw")
      loader2 = document.createElement("div")
      loader2.setAttribute("id", "loading2")
      loader2.setAttribute("class", "loading2")
      loader2.innerHTML = `

              <img style="" src="images/loading.gif" alt="loading...">

        `
      b.appendChild(loader2)

      fetcher("https://agroserver-mdz5.onrender.com/data/withdraw/")
        .then(data => {
          loader2.style.display = "none"
          totalAmount = 0
          data.forEach((item, index) => {
            if (item.status == true) { totalAmount += parseInt(item.amount) }
          });

          document.querySelector("#totalWithdraw").textContent = `${totalAmount}`
          setTimeout(() => {
            document.querySelector("#totalWithdraw").textContent = "Total Withdraw"
          }, 2000);
        })
    })
    document.querySelector("#totalWithdraw").addEventListener("dblclick", () => {
      document.querySelector("#withpopuppage").style.display = "block"
    })
    document.querySelector("#withdrawpopupcancel").addEventListener("click", () => {
      document.querySelector("#withpopuppage").style.display = "none"
    })

    document.querySelector("#totalSell").addEventListener("click", () => {
      total = 0
      fetcher('https://agroserver-mdz5.onrender.com/data/sell/')
        .then((data) => {
          data.forEach(d => {
            // console.log(d.amount)
            if (d.status == true) { total += parseInt(d.amount) }
          })
          // alert(total)
          document.querySelector("#totalSell span").textContent = total
        })
      setTimeout(() => {
        document.querySelector("#totalSell span").textContent = "Total Sell"
      }, 2000);
    })
    document.querySelector("#totalcost").addEventListener("click", () => {
      total = 0
      fetcher('https://agroserver-mdz5.onrender.com/data/cost/')
        .then((data) => {
          data.forEach(d => {
            if (d.status == true) { total += parseInt(d.amount) }
          })
          document.querySelector("#totalcost span").textContent = total
        })
      setTimeout(() => {
        document.querySelector("#totalcost span").textContent = "Total cost"
      }, 2000);
    })
    document.querySelector("#totalDue").addEventListener("click", () => {
      total = 0
      fetcher('https://agroserver-mdz5.onrender.com/data/due/')
        .then((data) => {
          data.forEach(d => {
            // console.log(d.amount)
            if (d.status == true) { total += parseInt(d.amount) }
          })
          document.querySelector("#totalDue span").textContent = total
        })
      setTimeout(() => {
        document.querySelector("#totalDue span").textContent = "Total Due"
      }, 2000);
    })

    document.querySelector("#addcostbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none";
      document.querySelector("#addcostpage").style.display = "flex";

      const table = document.querySelector("#costtablebody");
      table.innerHTML = "";
      let totalcost = 0;

      fetcher("https://agroserver-mdz5.onrender.com/data/cost/")
        .then(data => {
          data.forEach(d => {
            if (d.status === true) {
              totalcost += parseInt(d.amount);
              const row = document.createElement("tr");
              table.classList.add("costtablebody");

              row.innerHTML = `
            <td style="width: 85px; overflow-x: scroll;">${d.date}</td>
            <td>${d.note}</td>
            <td>
              ${d.amount}
              <span id="costdel-${d._id}" style="cursor:pointer; color:red; margin-left:8px;">del</span>
            </td>
          `;

              table.appendChild(row);

              // Add delete button functionality
              document.querySelector(`#costdel-${d._id}`).addEventListener("click", () => {
                document.querySelector("#refreshbtn").click()
                poster("https://agroserver-mdz5.onrender.com/delete/cost/", { id: d._id })
                  .then(response => {
                    if (response) {
                      const wdata = {
                        "date": d.date,
                        "amount": d.amount ? Math.abs(d.amount) : 0.00,
                        "note": "Cost decreased",
                        "status": true
                      };
                      if (d.method === "cash") {
                        poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
                      } else if (d.method === "bank") {
                        poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
                      }
                      row.remove();
                      totalcost -= parseInt(d.amount);
                      document.querySelector("#totalcost2").textContent = totalcost;
                    } else {
                      alert("Failed to delete item");
                    }
                  })
                  .catch(err => {
                    console.error("Delete error:", err);
                    alert("Error deleting item.");
                  });
              });
            }
          });

          document.querySelector("#totalcost2").textContent = totalcost ? totalcost : "loading..";
        });

      // Refresh Button Handler
      document.querySelector("#refreshbtn").addEventListener("click", () => {
        document.querySelector("#totalcost2").textContent = "loading..";
        table.innerHTML = "";
        let totalcost2 = 0;

        fetcher("https://agroserver-mdz5.onrender.com/data/cost/")
          .then(data => {
            data.forEach(d => {
              if (d.status === true) {
                totalcost2 += parseInt(d.amount);
                const row = document.createElement("tr");
                table.classList.add("costtablebody");

                row.innerHTML = `
              <td style="width: 85px; overflow-x: scroll;">${d.date}</td>
              <td>${d.note}</td>
              <td>
                ${d.amount}
                <span id="costdel-${d._id}" style="cursor:pointer; color:red; margin-left:8px;">del</span>
              </td>
            `;

                table.appendChild(row);

                // Add delete logic again for refreshed entries
                document.querySelector(`#costdel-${d._id}`).addEventListener("click", () => {
                  poster("https://agroserver-mdz5.onrender.com/delete/cost/", { id: d._id })
                    .then(response => {
                      if (response.status == "success") {
                        console.log(d, response)
                        row.remove();
                        const wdata = {
                          "date": d.date,
                          "amount": d.amount ? Math.abs(d.amount) : 0.00,
                          "note": "Cost decreased",
                          "status": true
                        };
                        if (d.method === "cash") {
                          poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
                        } else if (d.method === "bank") {
                          poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
                        }

                        totalcost2 -= parseInt(d.amount);
                        document.querySelector("#totalcost2").textContent = totalcost2;
                      } else {
                        alert("Failed to delete item");
                      }
                    })
                    .catch(err => {
                      console.error("Delete error:", err);
                      alert("Error deleting item.");
                    });
                });
              }
            });

            document.querySelector("#totalcost2").textContent = totalcost2 ? totalcost2 : "loading..";
          });
      });
    });


    document.querySelector("#addcostpagecancel").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#addcostpage").style.display = "none"
      document.querySelector("#costtablebody").innerHTML = ``
      location.reload()
    })

    let totalSell = 0;

    document.querySelector("#addsellbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none";
      document.querySelector("#addsellpage").style.display = "flex";

      totalSell = 0;

      // Fetch and render sales data
      fetcher("https://agroserver-mdz5.onrender.com/data/sell/")
        .then((data) => {
          document.querySelector("#totalsellhappened").textContent = "loading..";
          let table = document.querySelector("#tablesell");
          table.innerHTML = ""; // Clear previous rows

          data.forEach((d) => {
            if (d.status == true) {
              totalSell += parseInt(d.amount);

              let row = document.createElement("tr");
              row.innerHTML = `
            <td style="width: 85px; overflow-x: scroll; height:25px;">${d.date}</td>
            <td>${d.note}</td>
            <td>${d.buyerName}</td>
            <td >${d.productList}</td>
            <td style="">
              ${d.amount}
              <buton class="seeldel" data-id="${d._id}" style="color:red;margin-left:20px;"> del</button>
            </td>
          `;

              table.appendChild(row);

              // Bind delete button after adding row
              row.querySelector(".seeldel").addEventListener("click", () => {
                poster("https://agroserver-mdz5.onrender.com/delete/sell/", { id: d._id })
                  .then(() => {
                    row.remove(); // Remove from DOM
                    totalSell -= parseInt(d.amount); // Update total
                    document.querySelector("#totalsellhappened").textContent = totalSell;


                    let checkDue = parseInt(d.amount) - (parseInt(d.quantity) * parseInt(d.eachprice))
                    let due = false

                    decreaser(d.productList, -Math.abs(d.quantity))
                    // document.querySelector("#currentstock").textContent = res.find(p => p.note === productList).amount -= quantity;


                    if (checkDue < 0) {
                      due = true
                    }
                    else {
                      due = false
                    }
                    // Decrease from cash or bank
                    const wdata = {
                      "date": d.date,
                      "amount": d.amount ? -Math.abs(d.amount) : 0.00,
                      "note": `Sell delted To ${d.method ? d.method : "cash"} for sell to ${d.buyerName ? d.buyerName : "Annonymous Buyer"} at ${d.date} || product: ${d.productList}, quantity: ${d.quantity}`,
                      "status": true
                    };
                    const wdata2 = {
                      "date": d.date,
                      "amount": due ? parseInt(-Math.abs(checkDue)) : 0.00,
                      "note": `sell deleted so due due deleted ${d.buyerName ? d.buyerName : "annonymous with method: " + d.method} || date : ${d.date}, product : ${d.productList}, quantity: ${d.quantity}`,
                      "status": true
                    };

                    if (d.method === "cash") {
                      poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
                    } else if (d.method === "bank") {
                      poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
                    }
                    if (due) {
                      // console.log(due, " ", checkbox.checked)
                      poster('https://agroserver-mdz5.onrender.com/insert/due/', wdata2);
                    }
                  })
                  .catch(err => {
                    console.error("Delete failed:", err);
                    alert("Failed to delete. Please try again.");
                  });
              });
            }
          });

          document.querySelector("#totalsellhappened").textContent = totalSell;
        });

      // Fetch and populate product list
      fetcher("https://agroserver-mdz5.onrender.com/data/products/")
        .then((data) => {
          let selection = document.querySelector("#productselect");
          let stock = document.querySelector("#currentstock");
          selection.innerHTML = ""; // Clear existing options
          stock.textContent = ""; // Reset stock display

          data.forEach((d) => {
            let opt = document.createElement("option");
            opt.value = d.note;
            opt.textContent = d.note;
            selection.appendChild(opt);
          });

          // Update stock when product changes
          selection.addEventListener("change", () => {
            const selectedProduct = selection.value;
            const selected = data.find(p => p.note === selectedProduct);
            stock.textContent = selected ? selected.amount : "0";
          });

          // Initial stock display
          if (data.length > 0) {
            stock.textContent = data[0].amount;
          }
        });
    });

    document.querySelector("#quantitysell").addEventListener("input", (e) => {
      const selectedProduct = document.querySelector("#productselect").value

      // Fetch product data just for validation
      fetcher("https://agroserver-mdz5.onrender.com/data/products/")
        .then((products) => {
          const product = products.find(p => p.note === selectedProduct)
          const stockAmount = product ? parseInt(product.amount) : 0
          const inputAmount = parseInt(e.target.value)

          if (inputAmount > stockAmount) {
            alert("Sell amount exceeds available stock!")
            e.target.value = stockAmount
          }
        })
    })

    document.querySelector("#addsellpagecancel").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#addsellpage").style.display = "none"
      document.querySelector("#tablesell").innerHTML = ``
      location.reload()
    })

    document.querySelector("#totalproductbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none";
      document.querySelector("#totalproductpage").style.display = "flex";

      fetcher("https://agroserver-mdz5.onrender.com/data/products/")
        .then((data) => {
          let tablebody = document.querySelector("#productlisttable");
          tablebody.innerHTML = ""; // clear old rows if any

          data.forEach(d => {
            if (d.status == true) {

              const row = document.createElement("tr");
              row.classList.add("productpagetable");

              row.innerHTML = `
            <td style="padding: 5px; width: 80%;">${d.note}</td>
            <td style="padding: 5px;">
              <span id="amount-${d._id}">
                ${d.amount}
                <button id="btn-${d._id}">edit</button>
              </span>
            </td>
          `;

              tablebody.appendChild(row);

              bindEditButton(d); // bind edit logic per row
            }
          });
        });
    });

    function bindEditButton(d) {
      const editBtn = document.querySelector(`#btn-${d._id}`);
      const amountSpan = document.querySelector(`#amount-${d._id}`);

      editBtn.addEventListener("click", () => {
        amountSpan.innerHTML = `
      <div style="display: flex; justify-content: center; align-items: center;">
        <input type="number" placeholder="Enter" value="${d.amount}" id="newAmount-${d._id}">
        <button id="save-${d._id}">Save</button>
        <button id="cancel-${d._id}">Back</button>
      </div>
    `;

        // Save
        document.querySelector(`#save-${d._id}`).addEventListener("click", () => {
          const newAmount = document.querySelector(`#newAmount-${d._id}`).value;
          console.log(newAmount)
          poster(`https://agroserver-mdz5.onrender.com/edit/products/`, { "id": d._id, amount: newAmount ? Number(newAmount) : 0 })
            .then(() => {
              // location.reload()
              document.querySelector("#totalproductbtn").click()
            });

        });

        // Cancel
        document.querySelector(`#cancel-${d._id}`).addEventListener("click", () => {
          amountSpan.innerHTML = `
        ${d.amount}
        <button id="btn-${d._id}">edit</button>
      `;
          bindEditButton(d); // Re-bind the edit button again after cancel
        });
      });

    }

    document.querySelector("#totalproductbackbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#totalproductpage").style.display = "none"
      document.querySelector("#productlisttable").innerHTML = ``
    })

    document.querySelector("#addduebtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none";
      document.querySelector("#addduepage").style.display = "flex";
      document.querySelector("#totalsuespan").textContent = "loading..";

      let totalDue = 0;
      document.querySelector("#addduetable").innerHTML = ""; // Clear old rows

      fetcher('https://agroserver-mdz5.onrender.com/data/due/')
        .then((data) => {
          data.forEach(d => {
            if (d.status == true) {
              totalDue += parseInt(d.amount);
              renderDueRow(d);
            }
          });
          document.querySelector("#totalsuespan").textContent = totalDue;
        });
    });

    function renderDueRow(d) {
      const row = document.createElement("tr");
      row.innerHTML = `
      <td style="overflow: auto;">${d.date}</td>
      <td style="overflow: scroll;">${d.note}</td>
      <td style="display:flex; justify-content:space-around; align-items:center;" id="due-cell-${d._id}">
        <span id="amountDue-${d._id}">${d.amount}</span>
        <button id="dueeditbtn-${d._id}">‚úèÔ∏è</button>
      </td>
    `;

      document.querySelector("#addduetable").appendChild(row);

      bindEditButton3(d);
    }

    function bindEditButton3(d) {
      const editBtn = document.querySelector(`#dueeditbtn-${d._id}`);
      const cell = document.querySelector(`#due-cell-${d._id}`);

      editBtn.addEventListener("click", () => {
        cell.innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; gap: 5px;">
          <input type="number" id="due-newAmount-${d._id}" value="${d.amount}" style="width: 80px;">
          <button id="due-save-${d._id}">Save</button>
          <button id="due-cancel-${d._id}">Cancel</button>
        </div>
      `;

        // Save handler
        document.querySelector(`#due-save-${d._id}`).addEventListener("click", () => {
          const newAmount = document.querySelector(`#due-newAmount-${d._id}`).value;
          poster('https://agroserver-mdz5.onrender.com/edit/due/', { id: d._id, amount: newAmount ? Number(newAmount) : 0 })
            .then(() => {
              document.querySelector("#addduebtn").click(); // Refresh the entire table
            });
        });

        // Cancel handler
        document.querySelector(`#due-cancel-${d._id}`).addEventListener("click", () => {
          // Re-render just this cell to restore the original display
          cell.innerHTML = `
          <span id="amountDue-${d._id}">${d.amount}</span>
          <button id="dueeditbtn-${d._id}">‚úèÔ∏è</button>
        `;
          bindEditButton3(d); // Rebind the edit button after cancel
        });
      });
    }

    document.querySelector("#addduepagecancel").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#addduepage").style.display = "none"
      document.querySelector("#addduetable").innerHTML = ``
      location.reload()
    })

    document.querySelector("#settingbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none"
      document.querySelector("#settingpage").style.display = "flex"
    })
    document.querySelector("#settingpagecancelbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#settingpage").style.display = "none"
    })

    document.querySelector("#notebtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "none";
      document.querySelector("#notepage").style.display = "flex";

      // Clear existing rows before refetching
      document.querySelector("#notepadtablebody").innerHTML = "";

      fetcher('https://agroserver-mdz5.onrender.com/data/note/')
        .then((data) => {
          data.forEach(d => {
            if (d.status !== false) { // ‚úÖ Only show non-deleted notes
              renderNoteRow(d);
            }
          });
        });
    });

    function renderNoteRow(d) {
      let parent = document.querySelector("#notepadtablebody");
      let row = document.createElement("tr");
      row.id = `row-${d._id}`; // Add ID to easily remove later

      row.innerHTML = `
    <td style="width:150px;">${d.date}</td>
    <td style="width:250px;">${d.title}</td>
    <td style="display:flex; justify-content:space-between; align-items:center;" id="note${d._id}">
      <span>${d.amount}</span>
      <div style="display: flex; gap: 5px;">
        <button id="noteEdit${d._id}">edit</button>
        <button id="noteDelete${d._id}" style="color: red;">delete</button>
      </div>
    </td>
  `;

      parent.appendChild(row);

      bindEditButton2(d);
      bindDeleteButton(d);
    }

    function bindEditButton2(d) {
      const editBtn = document.querySelector(`#noteEdit${d._id}`);
      const cell = document.querySelector(`#note${d._id}`);

      editBtn.addEventListener("click", () => {
        cell.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <input type="text" id="edit-amount-${d._id}" value="${d.amount}" style="flex: 1; margin-right: 10px;">
        <button id="save-amount-${d._id}">Save</button>
        <button id="cancel-amount-${d._id}">Cancel</button>
      </div>
    `;

        // Save handler
        document.querySelector(`#save-amount-${d._id}`).addEventListener("click", () => {
          const newAmount = document.querySelector(`#edit-amount-${d._id}`).value;

          poster('https://agroserver-mdz5.onrender.com/edit/note/', {
            id: d._id,
            amount: newAmount
          }).then(() => {
            document.querySelector(`#note${d._id}`).innerHTML = `
          <span>${newAmount}</span>
          <div style="display: flex; gap: 5px;">
            <button id="noteEdit${d._id}">edit</button>
            <button id="noteDelete${d._id}" style="color: red;">delete</button>
          </div>
        `;
            // Update the data and rebind buttons
            d.amount = newAmount;
            bindEditButton2(d);
            bindDeleteButton(d);
          });
        });

        // Cancel handler
        document.querySelector(`#cancel-amount-${d._id}`).addEventListener("click", () => {
          cell.innerHTML = `
        <span>${d.amount}</span>
        <div style="display: flex; gap: 5px;">
          <button id="noteEdit${d._id}">edit</button>
          <button id="noteDelete${d._id}" style="color: red;">delete</button>
        </div>
      `;
          bindEditButton2(d);
          bindDeleteButton(d);
        });
      });
    }

    function bindDeleteButton(d) {
      const deleteBtn = document.querySelector(`#noteDelete${d._id}`);
      deleteBtn.addEventListener("click", () => {
        if (confirm("Are you sure you want to delete this note?")) {
          poster('https://agroserver-mdz5.onrender.com/delete/note/', {
            id: d._id
          }).then(() => {
            const row = document.querySelector(`#row-${d._id}`);
            if (row) row.remove(); // ‚úÖ Remove note from table immediately
          }).catch(() => {
            alert("Failed to delete (soft delete) the note.");
          });
        }
      });
    }

    document.querySelector("#notepagecancelbtn").addEventListener("click", () => {
      document.querySelector("#homepage").style.display = "block"
      document.querySelector("#notepage").style.display = "none"
      document.querySelector("#notepadtablebody").innerHTML = ``
    })

    document.querySelector("#addnewproduct").addEventListener("click", () => {
      document.querySelector("#addproductpopup").style.display = "block"
    })
    document.querySelector("#newproductcencel").addEventListener("click", () => {
      document.querySelector("#addproductpopup").style.display = "none"
    })

    document.querySelector("#logoimg").addEventListener("dblclick", () => {
      let path = ""
      document.querySelector("#logoimg").style.display = "none"
      const inputimg = document.createElement("input")
      const cancelbtn55 = document.createElement("button")
      const donebtn = document.createElement("button")
      cancelbtn55.textContent = "Cancel"
      donebtn.textContent = "done"
      cancelbtn55.setAttribute("id", "cancelbtn55cancel")
      donebtn.setAttribute("id", "donebtn55")
      inputimg.setAttribute("id", "inputfile55")
      inputimg.setAttribute("type", "file")
      document.querySelector("#logocont").appendChild(cancelbtn55)
      document.querySelector("#logocont").appendChild(donebtn)
      document.querySelector("#logocont").appendChild(inputimg)
      inputimg.addEventListener("change", () => {
        const file = inputimg.files[0]
        if (file) {
          path = file.name
        }
        document.querySelector("#logoimg").setAttribute("src", `${path}`)
      })
      donebtn.addEventListener("click", () => {
        document.querySelector("#logoimg").style.display = "block"
        donebtn.style.display = "none"
        inputimg.style.display = "none"
        cancelbtn55.style.display = "none"
      })
    })

    document.querySelector("#histbank").addEventListener("click", () => {
      let b = document.querySelector("#alltimehistory");
      b.style.display = "block";
      b.appendChild(loader);

      fetcher("https://agroserver-mdz5.onrender.com/data/bank/")
        .then(data => {
          totalAmount = 0;
          document.querySelector("#histtable").innerHTML = ""; // Clear previous entries

          data.forEach((item, index) => {
            if (item.status == true) {
              totalAmount += parseInt(item.amount);
              let row = document.createElement("tr");
              row.style.width = "100%";
              row.setAttribute("data-id", item._id); // Add row ID for easier deletion

              row.innerHTML = `
            <td style="width: 85px; overflow-x: auto;">${item.date}</td>
            <td style="overflow-x: auto;">${item.note}</td>
            <td style="width: 85px; overflow-x: auto;">
              ${item.amount}
              <span id="bankhistdel-${item._id}" style="cursor:pointer; color:red; margin-left: 8px;">del</span>
            </td>
          `;

              document.querySelector("#histtable").appendChild(row);
              loader.style.display = "none";

              // Add delete event listener
              document.querySelector(`#bankhistdel-${item._id}`).addEventListener("click", () => {
                poster("https://agroserver-mdz5.onrender.com/delete/bank/", { id: item._id })
                  .then(response => {
                    if (response) {
                      // Remove row from DOM
                      row.remove();
                      // Update totalAmount
                      totalAmount -= parseInt(item.amount);
                      document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount}</span>`;
                    } else {
                      alert("Failed to delete");
                    }
                  })
                  .catch(err => {
                    console.error("Delete error:", err);
                    alert("Error deleting item");
                  });
              });
            }
          });

          document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount ? totalAmount : "loading"}</span>`;
        });
    });


    document.querySelector("#histcash").addEventListener("click", () => {
      let b = document.querySelector("#alltimehistory");
      b.style.display = "block";
      b.appendChild(loader);

      fetcher("https://agroserver-mdz5.onrender.com/data/cash/")
        .then(data => {
          totalAmount = 0;
          document.querySelector("#histtable").innerHTML = ""; // Clear old entries

          data.forEach((item, index) => {
            if (item.status == true) {
              totalAmount += parseInt(item.amount);
              let row = document.createElement("tr");
              row.style.width = "100%";
              row.setAttribute("data-id", item._id); // Add for reference

              row.innerHTML = `
            <td style="width: 85px; overflow-x: auto;">${item.date}</td>
            <td style="overflow-x: auto;">${item.note}</td>
            <td style="width: 85px; overflow-x: auto;">
              ${item.amount}
              <span id="cashhistdel-${item._id}" style="cursor:pointer; color:red; margin-left: 8px;">del</span>
            </td>
          `;

              document.querySelector("#histtable").appendChild(row);
              loader.style.display = "none";

              // Attach delete logic
              document.querySelector(`#cashhistdel-${item._id}`).addEventListener("click", () => {
                poster("https://agroserver-mdz5.onrender.com/delete/cash/", { id: item._id })
                  .then(response => {
                    if (response) {
                      row.remove();
                      totalAmount -= parseInt(item.amount);
                      document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount}</span>`;
                    } else {
                      alert("Failed to delete entry.");
                    }
                  })
                  .catch(err => {
                    console.error("Delete error:", err);
                    alert("Error deleting entry.");
                  });
              });
            }
          });

          document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount ? totalAmount : "loading"}</span>`;
        });
    });


    document.querySelector("#histwithdraw").addEventListener("click", () => {
      let b = document.querySelector("#alltimehistory");
      b.style.display = "block";
      b.appendChild(loader);

      fetcher("https://agroserver-mdz5.onrender.com/data/withdraw/")
        .then(data => {
          totalAmount = 0;
          document.querySelector("#histtable").innerHTML = ""; // Clear previous entries

          data.forEach((item, index) => {
            if (item.status == true) {
              totalAmount += parseInt(item.amount);
              let row = document.createElement("tr");
              row.style.width = "100%";
              row.setAttribute("data-id", item._id);

              row.innerHTML = `
            <td style="width: 85px; overflow-x: auto;">${item.date}</td>
            <td style="overflow-x: auto;">${item.note}</td>
            <td style="width: 85px; overflow-x: auto;">
              ${item.amount}
              <span id="withdeldel-${item._id}" style="cursor:pointer; color:red; margin-left:8px;">del</span>
            </td>
          `;

              document.querySelector("#histtable").appendChild(row);
              loader.style.display = "none";

              // Add delete event
              document.querySelector(`#withdeldel-${item._id}`).addEventListener("click", () => {
                poster("https://agroserver-mdz5.onrender.com/delete/withdraw/", { id: item._id })
                  .then(response => {
                    if (response) {
                      const wdata = {
                        "date": item.date,
                        "amount": item.amount ? Math.abs(item.amount) : 0.00,
                        "note": "with decreased by deletion",
                        "status": true
                      };

                      if (item.withdrawType === "cash") {
                        // console.log(item)
                        poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
                      } else if (item.withdrawType === "bank") {
                        poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
                      }
                      row.remove();
                      totalAmount -= parseInt(item.amount);
                      document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount}</span>`;
                    } else {
                      alert("Failed to delete entry.");
                    }
                  })
                  .catch(err => {
                    console.error("Delete error:", err);
                    alert("Error deleting entry.");
                  });
              });
            }
          });

          document.querySelector("#totalbankamount").innerHTML = `<span>total amount: ${totalAmount ? totalAmount : "loading"}</span>`;
        });
    });


    document.querySelector("#histwithdraw").addEventListener("click", () => {
      document.querySelector("#alltimehistory").style.display = "block"
    })
    document.querySelector("#historycencel").addEventListener("click", () => {
      document.querySelector("#alltimehistory").style.display = "none"
      let tablerows = document.querySelector("#histtable")
      tablerows.innerHTML = ""

      loader.style.display = "flex"
    })


    //  insert funcitons

    document.querySelector("#addbankdata").addEventListener("click", () => {
      let date = document.querySelector("#bankdate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }
      amount = document.querySelector("#bankamount").value;
      note = document.querySelector("#banknote").value;
      data = {
        "date": date,
        "amount": amount ? amount : 0,
        "note": note ? note : "No Note Added!!",
        "status": true
      }
      poster('https://agroserver-mdz5.onrender.com/insert/bank/', data)
        .then(() => {
          document.querySelector(".idclassforsuccess").style.display = "block"
        })
      setTimeout(() => {
        document.querySelector(".idclassforsuccess").style.display = "none"
      }, 3000)

    })

    document.querySelector("#addcashdata").addEventListener("click", () => {
      let date = document.querySelector("#addcashdate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }
      amount = document.querySelector("#addcashamount").value;
      note = document.querySelector("#addcashnote").value;
      data = {
        "date": date,
        "amount": amount ? amount : 0,
        "note": note ? note : "No Note Added!!",
        "status": true
      }
      poster('https://agroserver-mdz5.onrender.com/insert/cash/', data)
        .then(() => {
          document.querySelector("#cashaddsuccess").style.display = "block"
        })
      setTimeout(() => {
        document.querySelector("#cashaddsuccess").style.display = "none"
      }, 3000)
    })

    document.querySelector("#addWithdraw").addEventListener("click", async () => {
      let date = document.querySelector("#withdrawdate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }

      let amount = parseFloat(document.querySelector("#withdrawamount").value);
      let note = document.querySelector("#withdrawnote").value;
      let Wtype = document.querySelector("#SelectWithdraw").value;

      const data = {
        "date": date,
        "amount": isNaN(amount) ? 0 : amount,
        "note": note || "No Note Added!!",
        "withdrawType": Wtype || "cash",
        "status": true
      };

      try {
        const res = await poster('https://agroserver-mdz5.onrender.com/insert/withdraw/', data);
        if (res) {
          document.querySelector("#withdrawaddsuccess").style.display = "block"

          if (Wtype === "cash") {
            const wdata = {
              "date": date,
              "amount": amount ? -Math.abs(amount) : 0,
              "note": "Withdraw from cash",
              "status": true
            };
            await poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
          }
          if (Wtype === "bank") {
            const wdata = {
              "date": date,
              "amount": amount ? -Math.abs(amount) : 0,
              "note": "Withdraw from cash",
              "status": true
            };
            await poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
          }



          setTimeout(() => {
            document.querySelector("#withdrawaddsuccess").style.display = "none"
          }, 3000)
        }

        else {
          console.error("Unexpected response:", res);
        }
      } catch (error) {
        console.error("Error in withdrawal:", error);
      }
    });

    document.querySelector("#addcostdata").addEventListener("click", async () => {

      let date = document.querySelector("#addcostdate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }
      let amount = parseFloat(document.querySelector("#costaddamount").value);
      let note = document.querySelector("#costaddnote").value;
      let method = document.querySelector("#addcostmethod").value;



      if (Number(amount) <= 0 || isNaN(amount)) {
        console.log("what is halppeing.")
        document.querySelector("#costaddsuccess").style.display = "block"
        document.querySelector("#costaddsuccess").style.color = "red"
        document.querySelector("#costaddsuccess").textContent = "Pls Enter All Required Fields(check these: amount, Each price, Quantity Etc)"
        setTimeout(() => {
          document.querySelector("#costaddsuccess").style.display = "none"
          document.querySelector("#costaddsuccess").style.color = "green"
          document.querySelector("#costaddsuccess").textContent = "Successfully Added!!"

        }, 2000);
        return
      }

      const data = {
        "date": date,
        "amount": isNaN(amount) ? 0 : amount,
        "note": note || "No Note Added!!",
        "method": method || "cash",
        "status": true
      };

      try {
        const res = await poster('https://agroserver-mdz5.onrender.com/insert/cost/', data);

        if (res) {
          document.querySelector("#refreshbtn").click()
          document.querySelector("#costaddsuccess").style.display = "block";
          setTimeout(() => {
            document.querySelector("#costaddsuccess").style.display = "none";
          }, 2000);
          document.querySelector("#addcostmethod").selectedIndex = 0
          document.querySelector("#costaddnote").placeholder = "Enter Details"
          document.querySelector("#costaddamount").value = 0.0
          // Decrease from cash or bank
          const wdata = {
            "date": date,
            "amount": amount ? -Math.abs(amount) : 0.00,
            "note": "Cost deducted from cash/bank",
            "status": true
          };

          if (method === "cash") {
            await poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
          } else if (method === "bank") {
            await poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
          }

          // Show success message

        } else {
          console.error("Unexpected response from cost insert:", res);
        }
      } catch (error) {
        console.error("Error in cost insert:", error);
      }
    });

    document.querySelector("#addselldata").addEventListener("click", async () => {


      let checkbox = document.querySelector("#discountedCheck")
      let date = document.querySelector("#selldate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }

      let amount = parseFloat(document.querySelector("#totalamountrechived").value);
      let note = document.querySelector("#sellnote").value;
      let method = document.querySelector("#sellmethod").value;
      let buyerName = document.querySelector("#buyername").value;
      let eachprice = document.querySelector("#eachprice").value;
      let quantity = document.querySelector("#quantitysell").value;
      let productList = document.querySelector("#productselect").value;
      if (amount <= 0 || eachprice <= 0 || quantity <= 0) {
        document.querySelector("#selladdedsuccessfully").style.display = "block"
        document.querySelector("#selladdedsuccessfully").style.color = "red"
        document.querySelector("#selladdedsuccessfully").textContent = "Pls Enter All Required Fields(check these: amount, Each price, Quantity Etc)"
        setTimeout(() => {
          document.querySelector("#selladdedsuccessfully").style.display = "none"
          document.querySelector("#selladdedsuccessfully").style.color = "green"
          document.querySelector("#selladdedsuccessfully").textContent = "Successfully Added!!"

        }, 2000);
        return
      }
      const data = {
        "method": method || "cash",
        "productList": productList ? productList : "Not Added",
        "date": date,
        "buyerName": buyerName ? buyerName : "Name not added",
        "note": note || "No sell Detals Added!!",
        "quantity": quantity ? quantity : 0,
        "eachprice": eachprice ? eachprice : 0.0,
        "amount": isNaN(amount) ? 0 : amount,
        "status": true
      };

      try {
        const res = await poster('https://agroserver-mdz5.onrender.com/insert/sell/', data);
        totalDue = 0
        document.querySelector("#totalsellhappened").textContent = "loading.."
        fetcher('https://agroserver-mdz5.onrender.com/data/sell/')
          .then((datas) => {
            datas.forEach(d => {
              if (d.status == true) {
                totalDue += parseInt(d.amount)
              }
            })
            document.querySelector("#totalsellhappened").textContent = totalDue



          })

        if (res) {
          document.querySelector("#selladdedsuccessfully").style.display = "block"
          document.querySelector("#totalamountrechived").value = 0
          document.querySelector("#sellnote").value = ""
          document.querySelector("#buyername").value = ""
          document.querySelector("#eachprice").value = 0.0
          document.querySelector("#quantitysell").value = 0
          // document.querySelector("#productselect").selectedIndex = 0
          document.querySelector("#productselect").innerHTML = ``
          document.querySelector("#tablesell").innerHTML = ""
          document.querySelector("#addsellbtn").click()
          let checkDue = parseInt(data.amount) - (parseInt(data.quantity) * parseInt(data.eachprice))
          let due = false

          decreaser(productList, quantity)
          // document.querySelector("#currentstock").textContent = res.find(p => p.note === productList).amount -= quantity;


          if (checkDue < 0) {
            due = true
          }
          else {
            due = false
          }
          // Decrease from cash or bank
          const wdata = {
            "date": date,
            "amount": amount ? Math.abs(amount) : 0.00,
            "note": `Sell Added To ${method ? method : "cash"} for sell to ${buyerName ? buyerName : "Annonymous Buyer"} at ${date} || product: ${productList}, quantity: ${quantity}`,
            "status": true
          };
          const wdata2 = {
            "date": date,
            "amount": due ? parseInt(Math.abs(checkDue)) : 0.00,
            "note": `Due Added From Sell To ${buyerName ? buyerName : "annonymous with method: " + method} || date : ${date}, product : ${productList}, quantity: ${quantity}`,
            "status": true
          };

          if (method === "cash") {
            await poster('https://agroserver-mdz5.onrender.com/insert/cash/', wdata);
          } else if (method === "bank") {
            await poster('https://agroserver-mdz5.onrender.com/insert/bank/', wdata);
          }
          if (due && !checkbox.checked) {
            console.log(due, " ", checkbox.checked)
            await poster('https://agroserver-mdz5.onrender.com/insert/due/', wdata2);
          }

          // Show success message
          document.querySelector("#costaddsuccess").textContent = "Cost added successfully!!";
          document.querySelector("#costaddsuccess").style.color = "green";
          setTimeout(() => {
            document.querySelector("#selladdedsuccessfully").style.display = "none"
          }, 2000);
        } else {
          console.error("Unexpected response from cost insert:", res);
        }
      } catch (error) {
        console.error("Error in cost insert:", error);
      }
    });

    document.querySelector("#productaddlistbtn").addEventListener("click", () => {
      let date = document.querySelector("#bankdate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }

      const qCheck = document.querySelector("#procutquantity").value;
      const name = document.querySelector("#productname").value;

      // ‚úÖ Validate required fields
      if (qCheck <= 0 || isNaN(qCheck)) {
        const msg = document.querySelector("#prodaddsuccessmsg");
        msg.style.display = "block";
        msg.style.color = "red";
        msg.textContent = "Please enter a valid quantity!";
        setTimeout(() => {
          msg.style.display = "none";
          msg.style.color = "green";
          msg.textContent = "Data Added Successfully!!";
        }, 3000);
        return; // ‚õî Don't continue if invalid
      }

      const data = {
        date: date,
        amount: parseInt(qCheck),
        note: name || "Anonymous Product",
        "status": true
      };

      fetcher('https://agroserver-mdz5.onrender.com/data/products/')
        .then((products) => {
          const exists = products.some(p => p.note.toLowerCase() === name.toLowerCase());

          if (exists || name == "" || name == null) {
            const msg = document.querySelector("#prodaddsuccessmsg");
            msg.style.display = "block";
            msg.style.color = "red";
            msg.textContent = "This Product Name Already Exists. Choose a New Name!";
            setTimeout(() => {
              msg.style.display = "none";
              msg.style.color = "green";
              msg.textContent = "Data Added Successfully!!";
            }, 3000);
            return;
          }

          // ‚úÖ Safe to insert
          poster('https://agroserver-mdz5.onrender.com/insert/products/', data)
            .then(() => {
              document.querySelector("#prodaddsuccessmsg").style.display = "block";
              document.querySelector("#totalproductbtn").click();
              setTimeout(() => {
                document.querySelector("#prodaddsuccessmsg").style.display = "none";
              }, 2000);
            });
        });
    });

    document.querySelector("#addduedata").addEventListener("click", () => {
      let date = document.querySelector("#addduedate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }
      note = document.querySelector("#addduenote").value;
      amount = document.querySelector("#adddueamount").value;

      if (note == "" || amount <= 0 || isNaN(amount)) {
        document.querySelector("#msgsuccessfordue").style.display = "block"
        document.querySelector("#msgsuccessfordue").style.color = "red"
        document.querySelector("#msgsuccessfordue").textContent = "enter amount first!!"
        setTimeout(() => {
          document.querySelector("#msgsuccessfordue").style.display = "none"
          document.querySelector("#msgsuccessfordue").style.color = "green"
          document.querySelector("#msgsuccessfordue").textContent = "Data Added Successfully!!"

        }, 2000)
      }

      data = {
        "date": date,
        "note": note ? note : "You didn't added a Name, should have",
        "amount": amount ? parseInt(amount) : 0,
        "status": true
      }
      poster('https://agroserver-mdz5.onrender.com/insert/due/', data)
        .then(() => {
          document.querySelector("#addduenote").placeholder = "Add"
          document.querySelector("#adddueamount").value = 0
          success = document.querySelector("#msgsuccessfordue")
          success.style.display = "block"
          setTimeout(() => {
            success.style.display = "none"
          }, 2000)
          totalDue = 0
          fetcher('https://agroserver-mdz5.onrender.com/data/due/')
            .then((data) => {
              data.forEach(d => {
                // console.log(d.amount)
                if (d.status == true) {
                  totalDue += parseInt(d.amount)
                }
              })
              document.querySelector("#totalsuespan").textContent = totalDue
            })
        })

    })

    document.querySelector("#notedataaddbtn").addEventListener("click", () => {
      let date = document.querySelector("#notepadDate").value;
      if (!date) {
        date = new Date().toISOString().replace('T', ', ').split('.')[0];
      }
      title = document.querySelector("#notepadtitle").value;
      note = document.querySelector("#notepadnote").value;
      data = {
        "date": date,
        "title": title ? title : "No Title added",
        "amount": note ? note : "You didn't added a Name, should have",
        "status": true
      }
      poster('https://agroserver-mdz5.onrender.com/insert/note/', data)
        .then(() => {
          document.querySelector("#notepadtablebody").innerHTML = ``
          fetcher('https://agroserver-mdz5.onrender.com/data/note/')
            .then((data) => {
              document.querySelector("#notebtn").click();
            })
        })

    })

    document.querySelector("#changepasswordbtn").addEventListener("click", () => {
      const divva = document.createElement("div")
      divva.classList.add("cnhangepasspage")
      divva.innerHTML = `
      <input id="usr" type="text"> username
      <input id="oldpass" type="password" placeholder="Old password"> 
      <input id="newpass" type="password" placeholder="new pass">
      <button id="chngepassbtn">change</button>
      <button id="chngepasscancelbtn">cancel</button>
      `
      const lSection = document.querySelector("#login-section")
      document.body.innerHTML = ``
      document.body.appendChild(divva)

      document.querySelector("#chngepasscancelbtn").addEventListener("click", () => {
        location.reload()
      })
      document.querySelector("#chngepassbtn").addEventListener("click", () => {
        fetcher('https://agroserver-mdz5.onrender.com/data/user/')
          .then((data) => {
            let usr = document.querySelector("#usr").value
            let oldpass = document.querySelector("#oldpass").value
            let newpass = document.querySelector("#newpass").value
            const matched = data.find(d => d.user.toLowerCase() === usr.toLowerCase() && d.amount === oldpass);
            if (matched) {
              console.log(matched._id, newpass)
              poster(`https://agroserver-mdz5.onrender.com/edit/user/`, { "id": matched._id, "amount": newpass })

                .then(alert("Password changed"))
              document.querySelector("#logoutbtn").click()

            }
          })

      })


    })

    document.querySelector("#resetCollectionbtn").addEventListener("click", () => {
      // alert("ALert!!!!! (Remember! it will effect on the other database, such as bank balance or cash balance mismatch etc) ")
      let name = document.querySelector("#resetcollectionselect").value
      p = prompt(`Enter This name to confirm: "${name}"`)
      if (p.toLowerCase() === name.toLowerCase()) {

        fetcher(`https://agroserver-mdz5.onrender.com/reset/${name}/`)
          .then(() => {
            alert(`${name} deleted successfully!!`)
            localStorage.removeItem("loginTime")
            location.reload()
          })

      }


    })











  </script>

</body>

</html>